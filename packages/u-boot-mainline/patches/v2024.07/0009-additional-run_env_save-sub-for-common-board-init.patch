From cb1b00a4acfddeb5317124032cbda8f2c2e5330e Mon Sep 17 00:00:00 2001
From: yan <yan-wyb@foxmail.com>
Date: Thu, 3 Dec 2020 15:28:32 +0800
Subject: [PATCH 09/38] additional run_env_save sub for common board init

Signed-off-by: yan <yan-wyb@foxmail.com>
---
 common/board_r.c | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/common/board_r.c b/common/board_r.c
index da0b80f24f..670cdde78f 100644
--- a/common/board_r.c
+++ b/common/board_r.c
@@ -555,6 +555,17 @@ static int run_main_loop(void)
 	return 0;
 }
 
+static int run_env_save(void)
+{
+	if ( env_get("env_need_save") ){
+		printf("[i] env_need_save... ");
+		env_set("env_need_save",NULL);
+		run_command("saveenv",1);
+	}
+	return 0;
+}
+
+
 /*
  * Over time we hope to remove these functions with code fragments and
  * stub functions, and instead call the relevant function directly.
@@ -739,6 +750,7 @@ static init_fnc_t init_sequence_r[] = {
 #if defined(CFG_PRAM)
 	initr_mem,
 #endif
+	run_env_save,
 	run_main_loop,
 };
 
-- 
2.17.1

